FROM python:3.11-slim

WORKDIR /app

# Install system dependencies including Node.js for running tests
RUN apt-get update && apt-get install -y \
    git \
    curl \
    jq \
    build-essential \
    nodejs \
    npm \
    && rm -rf /var/lib/apt/lists/*

# Install Python dependencies
RUN pip install --no-cache-dir \
    openai \
    anthropic \
    PyGithub \
    schedule \
    redis \
    psycopg2-binary \
    requests \
    black \
    isort \
    ast-grep-py \
    pylint \
    mypy

# Copy agent scripts
COPY scripts/ai_developer.py /app/
COPY scripts/agent_base.py /app/
COPY scripts/utils.py /app/

# Create necessary directories
RUN mkdir -p /logs /workspace

# Set environment variables
ENV PYTHONUNBUFFERED=1
ENV AGENT_ROLE=developer
ENV AUTO_FIX_ISSUES=true
ENV AUTO_IMPLEMENT_FEATURES=true

# Run the AI developer agent
CMD ["python", "-u", "ai_developer.py"]